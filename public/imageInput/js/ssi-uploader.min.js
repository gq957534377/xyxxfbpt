(function(e,s){if(typeof module==="object"&&module.exports){module.exports=s(require("jquery"))}else{s(e.jQuery)}})(this,function(e){var s=function(e,s){this.options=s;this.$element="";this.language=f[this.options.locale];this.uploadList=[];this.totalProgress=[];this.toUpload=[];this.imgNames=[];this.totalFilesLength=0;this.successfulUpload=0;this.aborted=0;this.abortedWithError=0;this.pending=0;this.inProgress=0;this.currentListLength=0;this.init(e)};s.prototype.init=function(s){e(s).addClass("ssi-uploadInput").after(this.$element=e('<div class="ssi-uploader">'));var i=e(""+'<span class="ssi-InputLabel">'+'<button type="button" class="ssi-button success">'+this.language.chooseFiles+"</button>"+"</span>").append(s);var t=e('<button type="button" id="ssi-uploadBtn" class="ssi-button success ssi-hidden" >'+'<span class="ssi-btnIn">'+this.language.upload+"&nbsp;</span>"+'<div id="ssi-up_loading" class="ssi-btnIn"></div></button>');var r=e('<button id="ssi-clearBtn" class="ssi-hidden ssi-button info" >'+this.language.clear+"</button>");var o=e('<button id="ssi-abortBtn" class="ssi-button error ssi-cancelAll ssi-hidden" ><span class="inBtn">'+this.language.abort+" </span></button>");this.$element.append(e('<div class="ssi-buttonWrapper">').append(i,o,t,r));var a;if(!this.options.preview){this.$element.addClass("ssi-uploaderNP");var n=e('<table id="ssi-fileList" class="ssi-fileList"></table>');var l=e('<span class="ssi-namePreview"></span>');var p=e('<div id="ssi-uploadFiles" class="ssi-tooltip ssi-uploadFiles '+(this.options.dropZone?"ssi-dropZone":"")+'"><div id="ssi-uploadProgressNoPreview" class="ssi-uploadProgressNoPreview"></div></div>').append(l);var u=e('<div class="ssi-uploadDetails"></div>').append(n);a=e('<div class="ssi-uploadBoxWrapper ssi-uploadBox"></div>').append(p,u);this.$element.prepend(a)}else{a=e('<div id="ssi-previewBox" class="ssi-uploadBox ssi-previewBox '+(this.options.dropZone?'ssi-dropZonePreview ssi-dropZone"><div id="ssi-DropZoneBack">'+this.language.drag+"</div>":'">')+"</div>");this.$element.append(a)}var c=this;var f=i.find(".ssi-uploadInput");i.find("button").click(function(){f.trigger("click")});f.on("change",function(){c.toUploadFiles(this.files);f.val("")});if(c.options.dropZone){a.on("drop",function(e){e.preventDefault();a.removeClass("ssi-dragOver");var s=e.originalEvent.dataTransfer.files;c.toUploadFiles(s)});a.on("dragover",function(e){e.preventDefault();a.addClass("ssi-dragOver");return false});a.on("dragleave",function(e){e.preventDefault();a.removeClass("ssi-dragOver");return false})}if(!c.options.preview){p.click(function(){if(c.currentListLength>1)u.toggleClass("ssi-uploadBoxOpened")})}r.click(function(){c.clear();e("#imgFiles").val("")});var h;a.on("mouseenter",".ssi-statusLabel",function(s){var i=e(s.currentTarget);var t=i.attr("data-status");if(!t||t===""){return}var r="35";if(i.hasClass("ssi-noPreviewSubMessage")){r=0}h=e('<div class="ssi-infoTooltip">'+t+"</div>").appendTo(c.$element).css({top:i.position().top-r,left:i.position().left-5}).fadeIn("slow")});a.on("mouseleave",".ssi-statusLabel",function(){if(h)h.remove()});a.on("click",".ssi-removeBtn",function(s){var i=e(s.currentTarget);var o=i.data("delete");c.pending--;c.currentListLength--;if(c.pending===0){t.prop("disabled",true)}if(c.options.preview){i.parents("table.ssi-imgToUploadTable").remove()}else{var n=i.parents("tr.ssi-toUploadTr");l.html(c.currentListLength+" files");n.prev().remove();n.remove();if(c.currentListLength===1){d(c)}}c.toUpload[o]=null;c.imgNames[o]=null;if(c.currentListLength===0){if(!c.options.dropZone){a.removeClass("ssi-uploadNoDropZone")}r.addClass("ssi-hidden");t.addClass("ssi-hidden")}});a.on("click",".ssi-abortUpload",function(s){var i=e(s.currentTarget);var t=i.data("delete");c.abort(t)});t.click(function(){c.uploadFiles()});o.click(function(){c.abortAll()})};s.prototype.abortAll=function(){for(var e=0;e<this.uploadList.length;e++){if(typeof this.uploadList[e]==="object"){this.abort(e)}}};s.prototype.toUploadFiles=function(s){if(typeof this.options.maxNumberOfFiles==="number"){if(this.inProgress+this.pending>=this.options.maxNumberOfFiles){return}}var i=this,t=0,r,o="",a=this.$element.find("#ssi-uploadBtn"),n=this.$element.find("#ssi-clearBtn"),l=this.$element.find("#ssi-fileList"),d=this.$element.find(".ssi-uploadBox"),p=[];if(this.inProgress===0&&this.pending===0){this.clear()}var c=[],f=[],h="";var g,v=r=g=s.length;if(typeof this.options.maxNumberOfFiles==="number"){if(v>this.options.maxNumberOfFiles-(this.inProgress+this.pending)){v=g=this.options.maxNumberOfFiles-(this.inProgress+this.pending)}}for(var m=0;m<v;m++){var b=s[m],U=b.name.getExtension();if(e.inArray(U,this.options.allowed)===-1){if(r>v){v++}else{g--}if(e.inArray(U,c)===-1){c.push(U)}}else if((b.size*Math.pow(10,-6)).toFixed(2)>this.options.maxFileSize){if(r>v){v++}else{g--}f.push(u(b.name,U,15))}else if(e.inArray(b.name,this.imgNames)===-1){a.prop("disabled",false);L(b);this.pending++;this.currentListLength++}else{if(r>v){v++}else{g--}}}var y=c.length,$=f.length;if(y+$>0){if(y>0){h=this.language.extError.replaceText(c.toString().replace(/,/g,", "))}if($>0){h+=this.language.sizeError.replaceText(f.toString().replace(/,/g,", "),this.options.maxFileSize+"mb")}this.options.errorHandler.method(h,this.options.errorHandler.error)}function L(){var e=i.totalFilesLength+i.pending;if(e===0){if(i.options.preview){if(!i.options.dropZone){d.addClass("ssi-uploadNoDropZone")}}a.removeClass("ssi-hidden");n.removeClass("ssi-hidden")}n.prop("disabled",false);i.toUpload[e]=b;var s=b.name;var r=s.getExtension();i.imgNames[e]=s;if(i.options.preview){var c=function(i){return'<table class="ssi-imgToUploadTable ssi-pending">'+'<tr><td class="ssi-upImgTd">'+i+"</td></tr>"+'<tr><td><div id="ssi-uploadProgress'+e+'" class="ssi-hidden ssi-uploadProgress"></div></td></tr>'+'<tr><td><button data-delete="'+e+'" class=" ssi-button error ssi-removeBtn"><span class="trash10 trash"></span></button></td></tr>'+"<tr><td>"+u(s,r,15)+"</td></tr></table>"};var f=b.type.split("/");if(f[0]=="image"){a.prop("disabled",true);n.prop("disabled",true);var h=new FileReader;h.onload=function(){o+=c('<img class="ssi-imgToUpload" src=""/><i class="fa-spin fa fa-spinner fa-pulse"></i>');p[e]=h.result;t++;if(g===t){d.append(o);a.prop("disabled",false);n.prop("disabled",false);setTimeout(function(){v()},10);o="";g=[]}};h.readAsDataURL(b)}else{p[e]=null;d.append(c('<div class="document-item" href="test.mov" filetype="'+r+'"><span class = "fileCorner"></span></div>'));t++}}else{i.$element.find(".ssi-namePreview").html(e===0?u(s,r,13):i.currentListLength+1+" "+i.language.files);l.append('<tr class="ssi-space"><td></td></tr>'+'<tr class="ssi-toUploadTr ssi-pending"><td><div id="ssi-uploadProgress'+e+'" class="ssi-hidden ssi-uploadProgress ssi-uploadProgressNoPre"></div>'+"<span>"+u(s,r,20)+"</span></td>"+'<td><a data-delete="'+e+'" class="ssi-button ssi-removeBtn  ssi-removeBtnNP"><span class="trash7 trash"></span></a></td></tr>')}var v=function(){for(var e=0;e<p.length;e++){if(p[e]!==null){d.find("#ssi-uploadProgress"+e).parents("table.ssi-imgToUploadTable").find(".ssi-imgToUpload").attr("src",p[e]).next().remove();p[e]=null}}p=[]}}};var i=function(e){var s=e.$element.find(".ssi-completed");e.successfulUpload=0;e.aborted=0;e.abortedWithError=0;if(!e.options.preview)s.prev("tr").remove();s.remove()};var t=function(e){var s=e.$element.find(".ssi-pending");var i=e.imgNames.length;for(var t=0;t<i;t++){if(e.imgNames[t]===null){e.toUpload.splice(t,1);e.imgNames.splice(t,1)}}e.toUpload.splice(-e.pending,e.pending);e.imgNames.splice(-e.pending,e.pending);e.pending=0;if(!e.options.preview)s.prev("tr").remove();s.remove()};s.prototype.clear=function(e){switch(e){case"pending":t(this);break;case"completed":i(this);break;default:t(this);i(this)}var s=this.$element.find("#ssi-uploadBtn"),o=this.$element.find("#ssi-clearBtn");this.currentListLength=l(this);if(this.inProgress===0){this.totalProgress=[]}if(this.currentListLength===0){o.addClass("ssi-hidden");s.addClass("ssi-hidden");this.totalFilesLength=0;if(!this.options.dropZone){this.$element.find(".ssi-uploadBox").removeClass("ssi-uploadNoDropZone")}}o.prop("disabled",true);s.prop("disabled",true);if(!this.options.preview){r(this)}};var r=function(e){if(e.currentListLength>1){e.$element.find(".ssi-namePreview").html(e.currentListLength+" files")}else if(e.currentListLength===1){d(e)}else{e.$element.find(".ssi-uploadDetails").removeClass("ssi-uploadBoxOpened");e.$element.find("#ssi-fileList").empty();e.$element.find(".ssi-namePreview").empty()}};s.prototype.uploadFiles=function(){if(this.pending>0){this.$element.find("#ssi-abortBtn").removeClass("ssi-hidden");this.$element.find(".ssi-removeBtn").addClass("ssi-abortUpload").removeClass("ssi-removeBtn").children("span").removeClass("trash7 trash10 trash").addClass(this.options.preview?"ban7w":"ban7");var s=this.$element.find("#ssi-uploadBtn"),i=this.$element.find("#ssi-clearBtn");s.prop("disabled",true);var t=this,n=new FormData,l=this.totalFilesLength;if(this.totalFilesLength!==0&&!this.options.preview){r(this)}this.inProgress+=this.pending;this.totalFilesLength+=this.pending;this.pending=0;if(this.inProgress===this.currentListLength){i.prop("disabled",true)}while(this.toUpload[l]===null){l++}n.append("file",t.toUpload[l]);e.each(this.options.data,function(e,s){n.append(e,s)});if(typeof this.options.beforeUpload==="function"){try{this.options.beforeUpload()}catch(e){console.log("There is an error in beforeUpload callback");console.log(e);t.abortAll();return}}t.$element.find("input.ssi-uploadInput").trigger("beforeUpload.ssi-uploader");d(n,l)}function d(r,n){var u="table.ssi-imgToUploadTable";if(!t.options.preview){u="tr.ssi-toUploadTr"}var f=t.$element.find("#ssi-uploadProgress"+n);f.removeClass("ssi-hidden").parents(u).removeClass("ssi-pending");var h=e.extend({},{xhr:function(){var e=new window.XMLHttpRequest;e.upload.addEventListener("progress",function(e){if(e.lengthComputable){var i=e.loaded/e.total*100;if(f){f.css({width:i+"%"})}t.totalProgress[n]=i;var r=c(t.totalProgress)/(t.inProgress+t.successfulUpload);if(!t.options.preview){t.$element.find("#ssi-uploadProgressNoPreview").removeClass("ssi-hidden").css({width:r+"%"})}s.find("#ssi-up_loading").html(Math.ceil(r)+"%")}},false);return e},async:true,beforeSend:function(e){t.uploadList[n]=e;s.find("#ssi-up_loading").html('<i class="fa fa-spinner fa-pulse"></i>');if(typeof t.options.beforeEachUpload==="function"){try{var i=t.options.beforeEachUpload({name:t.toUpload[n].name,type:t.toUpload[n].type,size:(t.toUpload[n].size/1024).toFixed(2)},e)}catch(e){console.log("There is an error in beforeEachUpload callback");console.log(e);t.abortAll();return}}t.$element.find("input.ssi-uploadInput").trigger("beforeEachUpload.ssi-uploader");if(e.status===0){if(e.statusText==="canceled"){if(typeof i==="undefined"){i=false}t.abortedWithError++;t.abort(n,i)}}},type:"POST",data:r,cache:false,contentType:false,processData:false,url:t.options.url,error:function(e,s){if(s!=="abort"){f.addClass("ssi-canceledProgressBar");var r=t.language.error;t.abortedWithError++;t.totalProgress.splice(n,1);if(!t.options.preview){r='<span class="exclamation7"></span>'}o(t,n,"error",r,t.language.serverError);t.totalProgress[n]="";t.inProgress--;i.prop("disabled",false);if(typeof t.options.onEachUpload==="function"){try{t.options.onEachUpload({uploadStatus:"error",name:t.toUpload[n].name,size:(t.toUpload[n].size/1024).toFixed(2),type:t.toUpload[n].type})}catch(e){console.log("There is an error in onEachUpload callback");console.log(e)}}if(a(t)){p(t)}console.log(arguments);console.log(" Ajax error: "+s)}}},t.options.ajaxOptions);e.ajax(h).done(function(s,r,l){var d,u="",c="error",h="exclamation",g;try{g=e.parseJSON(s)}catch(e){g=s}if(t.options.responseValidation){var v=t.options.responseValidation;if(typeof v.validationKey==="object"&&v.resultKey=="validationKey"){if(g.hasOwnProperty(v.validationKey.success)){m(true)}else{m(false,g[v.validationKey.error])}}else{if(g[v.validationKey]==v.success){m(true)}else{m(false,g[v.resultKey])}}}else{if(l.status==200){m(true)}else{m(false,g)}}function m(e,s){if(e){c="success";d=t.language.success;h="check";t.successfulUpload++}else{f.addClass("ssi-canceledProgressBar");if(t.options.preview){d=t.language.error}u=s;t.abortedWithError++}}if(!t.options.preview){d='<span class="'+h+'7"></span>'}o(t,n,c,d,u);if(typeof t.options.onEachUpload==="function"){try{t.options.onEachUpload({uploadStatus:c,name:t.toUpload[n].name,size:(t.toUpload[n].size/1024).toFixed(2),type:t.toUpload[n].type},s)}catch(e){console.log("There is an error in onEachUpload callback");console.log(e)}}t.$element.find("input.ssi-uploadInput").trigger("onEachUpload.ssi-uploader");t.inProgress--;i.prop("disabled",false);if(a(t)){p(t)}t.uploadList[n]="";t.toUpload[n]="";t.imgNames[n]=""});l=n;l++;while(t.toUpload[l]===null){l++}if(l<t.toUpload.length){r=new FormData;e.each(t.options.data,function(e,s){r.append(e,s)});r.append("file",t.toUpload[l]);d(r,l)}}};var o=function(e,s,i,t,r){var o="",a="table.ssi-imgToUploadTable",l;if(!e.options.preview){o="ssi-noPreviewSubMessage";a="tr.ssi-toUploadTr";if(e.currentListLength===1){e.errors=r}}l=e.$element.find(".ssi-abortUpload[data-delete='"+s+"']");l.parents(a).addClass("ssi-completed");l.after(n(i,t,r,o)).remove()};var a=function(e){return e.inProgress===0};var n=function(e,s,i,t){return'<span class="ssi-statusLabel '+t+" "+e+'" data-status="'+i+'">'+s+"</span>"};var l=function(e){return e.inProgress+e.successfulUpload+e.aborted+e.abortedWithError+e.pending};var d=function(e){var s=e.$element.find("#ssi-fileList").find("span").html();var i=s.getExtension();e.$element.find(".ssi-uploadDetails").removeClass("ssi-uploadBoxOpened");e.$element.find(".ssi-namePreview").html(u(s,i,15))};s.prototype.abort=function(e,s){if(typeof s==="undefined"){this.uploadList[e].abort();this.totalProgress[e]="";s="Aborted";this.aborted++}else if(typeof s!=="string"){s=""}var i=this.language.aborted;if(!this.options.preview){i='<span class="ban7w"></span>'}o(this,e,"error",i,s);this.$element.find("#ssi-uploadProgress"+e).removeClass("ssi-hidden").addClass("ssi-canceledProgressBar");this.toUpload[e]=undefined;this.uploadList[e]=undefined;this.imgNames[e]=undefined;this.$element.find("#ssi-clearBtn").prop("disabled",false);this.inProgress--;if(a(this)){p(this)}};var p=function(e){e.$element.find("#ssi-abortBtn").addClass("ssi-hidden");if(!e.options.preview){var s="error",i="",t="";if(e.abortedWithError>0){if(e.totalFilesLength===1){i=e.errors}else{i=e.language.someErrorsOccurred}t='<span class="exclamation23"></span>'}else if(e.aborted>0&&e.successfulUpload===0){t='<span class="ban23"></span>';i=e.language.aborted}else if(e.successfulUpload>0){s="success";t='<span class="check23"></span>';i=e.language.sucUpload}e.$element.find(".ssi-namePreview").append(n(s,t,i,"ssi-noPreviewMessage"));e.$element.find("#ssi-uploadProgressNoPreview").removeAttr("styles").addClass("ssi-hidden")}if(typeof e.options.onUpload==="function"){try{e.options.onUpload()}catch(e){console.log("There is an error in onUpload callback");console.log(e)}}e.$element.find("input.ssi-uploadInput").trigger("onUpload.ssi-uploader");var r=e.$element.find("#ssi-uploadBtn");e.$element.find("#ssi-clearBtn").prop("disabled",false);r.prop("disabled",false).find("#ssi-up_loading").empty();if(e.pending===0){r.addClass("ssi-hidden");e.toUpload=[];e.imgNames=[];e.totalFilesLength=0}e.uploadList=[];e.totalProgress=[];e.currentListLength=l(e);e.successfulUpload=0;e.aborted=0;e.abortedWithError=0;e.inProgress=0};e.fn.ssi_uploader=function(i){var t={url:"",data:{},locale:"ch",preview:true,dropZone:true,maxNumberOfFiles:"",responseValidation:false,maxFileSize:2,ajaxOptions:{},onUpload:function(){},onEachUpload:function(){},beforeUpload:function(){},beforeEachUpload:function(){},allowed:["jpg","jpeg","png","bmp","gif"],errorHandler:{method:function(e){alert(e)},success:"success",error:"error"}};var r=e.extend(true,t,i);return this.each(function(){var i=e(this);if(i.is('input[type="file"]')){if(i.data("ssi_upload"))return;var t=new s(this,r);i.data("ssi_upload",t)}else{console.log("The targeted element is not file input.")}})};String.prototype.replaceText=function(){var e=Array.apply(null,arguments);var s=this;for(var i=0;i<e.length;i++){s=s.replace("$"+(i+1),e[i])}return s};String.prototype.getExtension=function(){return this.split(".").pop().toLowerCase()};var u=function(e,s,i){if(typeof s==="undefined")s="";if(typeof i==="undefined")i=10;var t=4;if(i<t)return;var r=s.length;var o=e.length;if(o-2>i){e=e.substring(0,i);var a=e.length-r;e=e.substring(0,a);return e+"..."+s}else return e};var c=function(e){var s=0;for(var i=0;i<e.length;i++){if(typeof e[i]==="number")s+=e[i]}return s};var f={en:{success:"Success",sucUpload:"Successful upload",chooseFiles:"Choose files",uploadFailed:"Upload failed",serverError:"Internal server error",error:"Error",abort:"Abort",aborted:"Aborted",files:"files",upload:"Upload",clear:"Clear",drag:"Drag n Drop",sizeError:"$1 exceed the size limit of $2",extError:"$1 file types are not supported",someErrorsOccurred:"Some errors occurred!"},ch:{success:"成功",sucUpload:"图片已上传",chooseFiles:"添加图片",uploadFailed:"图片上传失败",serverError:"服务器错误，刷新后重试",error:"上传失败",abort:"Abort",aborted:"失败信息",files:"files",upload:"上传",clear:"清空",drag:"可拖拽存入图片",sizeError:"$1 超过最大图片限制 $2",extError:"$1 类型图片暂不支持",someErrorsOccurred:"出错了!"},ch_video:{success:"成功",sucUpload:"视频已上传",chooseFiles:"添加视频",uploadFailed:"视频上传失败",serverError:"服务器错误，刷新后重试",error:"上传失败",abort:"Abort",aborted:"失败信息",files:"files",upload:"上传",clear:"清空",drag:"可拖拽存入视频",sizeError:"$1 超过最大图片限制 $2",extError:"$1 类型视频暂不支持",someErrorsOccurred:"出错了!"},ch_news_add:{success:"成功",sucUpload:"封面图片已上传",chooseFiles:"添加封面图片",uploadFailed:"封面图片上传失败",serverError:"服务器错误，刷新后重试",error:"上传失败",abort:"Abort",aborted:"失败信息",files:"files",upload:"上传",clear:"清空",drag:"可拖拽存入封面图片",sizeError:"$1 超过最大图片限制 $2",extError:"$1 类型图片暂不支持",someErrorsOccurred:"出错了!"},ch_news_change:{success:"成功",sucUpload:"封面图片已上传",chooseFiles:"修改封面图片",uploadFailed:"封面图片上传失败",serverError:"服务器错误，刷新后重试",error:"上传失败",abort:"Abort",aborted:"失败信息",files:"files",upload:"上传",clear:"清空",drag:"可拖拽存入封面图片",sizeError:"$1 超过最大图片限制 $2",extError:"$1 类型图片暂不支持",someErrorsOccurred:"出错了!"},ch_voice:{success:"成功",sucUpload:"语音素材已上传",chooseFiles:"添加语音素材",uploadFailed:"语音素材上传失败",serverError:"服务器错误，刷新后重试",error:"上传失败",abort:"Abort",aborted:"失败信息",files:"files",upload:"上传",clear:"清空",drag:"可拖拽存入语音文件",sizeError:"$1 超过最大文件限制 $2",extError:"$1 类型语音文件暂不支持",someErrorsOccurred:"出错了!"},gr:{success:"Επιτυχία",sucUpload:"Επιτυχής μεταφόρτωση",chooseFiles:"Επιλέξτε αρχεία",uploadFailed:"Η μεταφόρτωση απέτυχε!",serverError:"Εσωτερικό σφάλμα διακομιστή!",error:"Σφάλμα",abort:"Διακοπή",aborted:"Διακόπηκε",files:"αρχεία",upload:"Μεταφόρτωση",clear:"Εκκαθάριση",drag:"Συρετε εδώ...",sizeError:"$1 έχει ξεπεράσει το όριο των $2.",extError:"$1 αρχεία δεν υποστηρίζονται.",someErrorsOccurred:"Σημειώθηκαν ορισμένα λάθη!"}}});